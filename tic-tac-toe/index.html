<!DOCTYPE html>
<html lang="or">
  <title>Play Tic Tac Toe Online - Free 2 Player Game | Odia Games</title>

    <!-- Meta Description (Your ad in search results - under 160 characters) -->
    <meta name="description" content="Play the classic game of Tic Tac Toe (Noughts and Crosses) for free online. Challenge a friend in 2 player mode. Simple, fun, and no downloads required!">

    <!-- Meta Keywords (Good for some search engines) -->
    <meta name="keywords" content="tic tac toe, tic tac toe online, play tic tac toe, noughts and crosses, xs and os, 2 player game, free game, online game, odia games, Chheka Suna, ଛେକ ଶୂନ">

    <!-- Canonical URL (Tells Google the main version of this page) -->
    <link rel="canonical" href="https://odiagames.site/tic-tac-toe/">

    <!-- Favicon (Browser Tab Icon) -->
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/imsbg/odiagames/refs/heads/main/icon/ttt.png">

    <!-- 
    -------------------------------------------------
    -- Open Graph Tags (for Facebook, LinkedIn, etc.) --
    -------------------------------------------------
    -->
    <meta property="og:title" content="Play Tic Tac Toe Online - Free Classic Game">
    <meta property="og:description" content="Challenge a friend timeless game of Tic Tac Toe. Simple, fast, and fun for all ages. Play now for free on Odia Games!">
    <meta property="og:image" content="https://raw.githubusercontent.com/imsbg/odiagames/refs/heads/main/icon/ttt.png">
    <meta property="og:url" content="https://odiagames.site/tic-tac-toe/">
    <meta property="og:site_name" content="Odia Games">
    <meta property="og:type" content="website">

    <!-- 
    -------------------------------------------
    -- Twitter Card Tags (for Twitter Sharing) --
    -------------------------------------------
    -->
    <meta name="twitter:card" content="summary"> <!-- 'summary' is good for simple icon logos -->
    <meta name="twitter:title" content="Play Tic Tac Toe Online - Free 2 Player Game | Odia Games">
    <meta name="twitter:description" content="The classic Tic Tac Toe (Noughts and Crosses) game you know and love. Play against the computer or a friend for free!">
    <meta name="twitter:image" content="https://raw.githubusercontent.com/imsbg/odiagames/refs/heads/main/icon/ttt.png">
    <meta name="twitter:site" content="@yourtwitterhandle"> <!-- Optional: Your site's Twitter handle -->

<meta name="theme-color" content="#403285"/>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+Oriya:wght@400;700&family=Poppins:wght@600;700&display=swap"
      rel="stylesheet"
    />
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Game",
  "name": "Tic Tac Toe",
  "description": "Play the classic Tic Tac Toe game in Odia. Challenge your friends in this simple yet strategic two-player game. Test your wit and dominate the board!",
  "image": "https://odiagames.site/icon/ttt.png",
  "url": "https://odiagames.site/tic-tac-toe",
  "genre": "Strategy Game",
  "applicationCategory": "GameApplication",
  "author": {
    "@type": "Person",
    "name": "Sandeep Biswal G"
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.5", // Average rating (e.g., from 1 to 5)
    "reviewCount": "120"  // Total number of reviews/ratings
  },
  "description": "A free, web-based version of the classic Tic Tac Toe (also known as Noughts and Crosses). Players can compete against the computer or another player in 2 player mode. The goal is to be the first to get three of their marks in a row, either horizontally, vertically, or diagonally.",
  "applicationCategory": ["Game", "PuzzleGame", "BoardGame"],
  "gamePlatform": "Web-based game",
  "operatingSystem": "Requires a web browser",
  "playMode": "MultiPlayer",
  "keywords": "tic tac toe, noughts and crosses, 2 player, board game, online game"
}
</script>
    <style>
      :root {
        --bg-gradient-start: #403285;
        --bg-gradient-end: #403285;
        --container-bg: #403285;
        --input-bg: rgba(0, 0, 0, 0.15);
        --action-primary: #00f2a9;
        --action-secondary: #00d4d4;
        --text-light: #ffffff;
        --text-dark: #1e1e1e;
        --danger-red: #ff4d4d;
        --light-grey: rgba(255, 255, 255, 0.1);
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      html {
        font-size: 16px;
      }
      body {
        font-family: "Poppins", "Noto Sans Oriya", sans-serif;
        background: linear-gradient(
          180deg,
          var(--bg-gradient-start),
          var(--bg-gradient-end)
        );
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 15px;
      }

      .app-container {
        width: 100%;
        max-width: 400px;
        height: 850px;
        max-height: 100vh;
        position: relative;
        overflow: hidden;
        background: var(--container-bg);
        transition: filter 0.3s ease-in-out;
      }
      .app-container.blurred {
        filter: blur(8px);
        transform: scale(0.98);
      }

      .card {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: transparent;
        padding: 25px 35px;
        display: none;
        flex-direction: column;
      }
      .card.active {
        display: flex;
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: var(--text-light);
        flex-shrink: 0;
        height: 40px;
      }
      .icon {
        width: 28px;
        height: 28px;
        fill: var(--text-light);
      }
      .back-btn {
        background: none;
        border: none;
        padding: 0;
        margin: 0;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        opacity: 0.8;
        transition: opacity 0.2s;
      }
      .back-btn:hover {
        opacity: 1;
      }
      .lang-switch {
        width: 90px;
        height: 40px;
        background: var(--input-bg);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: 700;
        font-size: 16px;
        cursor: pointer;
        user-select: none;
        color: var(--text-light);
        font-family: "Poppins", "Noto Sans Oriya", sans-serif;
        transition: background-color 0.2s;
      }
      .lang-switch:hover {
        background-color: rgba(0, 0, 0, 0.25);
      }

      .card-body {
        text-align: center;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
      }
      #home-card .card-body {
        justify-content: center;
      }
      #home-card h1 {
        font-size: 3rem;
        margin-bottom: 50px;
        font-weight: 700;
      }
      .card-body h1,
      .card-body h2 {
        color: var(--text-light);
        font-weight: 700;
      }
      h2.card-title {
        font-size: 1.5rem;
        flex-grow: 1;
        text-align: center;
      }

      button,
      input[type="text"].modal-input {
        width: 100%;
        padding: 18px 20px;
        border: none;
        border-radius: 15px;
        font-size: 18px;
        font-weight: 700;
        cursor: pointer;
        font-family: "Poppins", "Noto Sans Oriya", sans-serif;
        margin-bottom: 15px;
        transition: all 0.2s ease;
        letter-spacing: 0.5px;
      }
      button:active {
        transform: scale(0.97);
      }
      button:disabled {
        background-color: #888 !important;
        color: #ccc !important;
        cursor: not-allowed;
        box-shadow: none;
      }
      input[type="text"].modal-input {
        background: var(--input-bg);
        color: var(--text-light);
        text-align: center;
      }
      input[type="text"].modal-input::placeholder {
        color: rgba(255, 255, 255, 0.5);
      }

      .btn-primary {
        background: var(--action-primary);
        color: var(--text-dark);
        box-shadow: 0 5px 20px -5px var(--action-primary);
      }
      .btn-secondary {
        background: var(--action-secondary);
        color: var(--text-dark);
        box-shadow: 0 5px 20px -5px var(--action-secondary);
      }
      .btn-tertiary {
        background: var(--input-bg);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: var(--text-light);
      }

      #lobby-card .card-body {
        justify-content: space-between;
      }
      #lobby-room-id-display {
        color: var(--text-light);
        font-size: 20px;
        margin: 20px 0;
      }
      #lobby-room-id-display span {
        color: var(--accent-yellow);
        font-weight: bold;
        user-select: all;
      }
      #player-list {
        margin: 20px 0;
        text-align: left;
        color: var(--text-light);
      }
      .player-item {
        display: flex;
        align-items: center;
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 20px;
        background: var(--input-bg);
        padding: 15px;
        border-radius: 10px;
      }
      .kick-btn {
        margin-left: auto;
        width: auto;
        padding: 5px;
        background: none;
        border: none;
        cursor: pointer;
      }
      
      /* *** FINAL UI LAYOUT FIX *** */
      #game-card {
        padding: 0;
      }
      #game-card .card-body {
        padding: 0;
        height: 100%; /* Make card body take full height of its container */
      }
      .game-header {
        display: flex;
        justify-content: flex-start;
        align-items: center;
        height: 40px;
        flex-shrink: 0;
        padding: 25px 35px 0 35px;
      }
      .game-main-content {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        min-height: 0;
        padding: 0 35px;
      }
      .game-footer {
        width: 100%;
        display: flex;
        justify-content: center;
        gap: 15px;
        padding: 25px 35px;
        margin-bottom: 60px;
        flex-shrink: 0;
      }
      .player-pod {
        width: 140px; 
        flex-shrink: 0;
        background: var(--input-bg);
        border-radius: 15px;
        padding: 15px;
        text-align: center;
        transition: all 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      .player-pod.active {
        transform: scale(1.05);
        box-shadow: 0 0 25px -5px var(--action-primary);
        border-color: var(--action-primary);
      }
      .player-pod .player-name {
        font-size: 1rem;
        font-weight: 600;
        opacity: 0.8;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .player-pod .player-score {
        font-size: 2rem;
        font-weight: 700;
      }
      .player-pod.p2.active {
        box-shadow: 0 0 25px -5px var(--action-secondary);
        border-color: var(--action-secondary);
      }

      .tic-tac-toe-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        width: 100%;
        max-width: 350px;
        margin: 0 auto;
        aspect-ratio: 1 / 1;
        position: relative;
      }
      .cell {
        display: flex;
        justify-content: center;
        align-items: center;
        background: var(--input-bg);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.2);
        border-radius: 20px;
        font-size: 3.5rem;
        font-weight: 700;
        color: var(--text-light);
        cursor: pointer;
        transition: all 0.2s ease;
      }
      .cell.win {
        background: var(--action-primary);
        color: var(--text-dark);
        transform: scale(1.1);
        box-shadow: 0 0 30px var(--action-primary);
      }
      .cell:not(.win):hover {
        background-color: rgba(0, 0, 0, 0.25);
        border-color: rgba(255, 255, 255, 0.3);
      }
      #game-result-text {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--text-light);
        height: 40px;
        flex-shrink: 0;
        margin-top: 20px;
      }
      
      #strike-line {
        position: absolute;
        background-color: var(--danger-red);
        height: 8px;
        border-radius: 4px;
        box-shadow: 0 0 10px 2px var(--danger-red);
        z-index: 5;
        opacity: 0;
      }
      #strike-line.visible {
        opacity: 1;
        transition: width 0.4s ease-out, height 0.4s ease-out;
      }
      .strike-row-1 { top: 16.6%; left: 5%; width: 0; height: 8px; transform-origin: left center; }
      #strike-line.visible.strike-row-1 { width: 90%; }
      .strike-row-2 { top: 50%; left: 5%; transform: translateY(-50%); width: 0; height: 8px; transform-origin: left center; }
      #strike-line.visible.strike-row-2 { width: 90%; }
      .strike-row-3 { top: 83.3%; left: 5%; transform: translateY(-50%); width: 0; height: 8px; transform-origin: left center; }
      #strike-line.visible.strike-row-3 { width: 90%; }
      .strike-col-1 { top: 5%; left: 16.6%; width: 8px; height: 0; transform-origin: top center; }
      #strike-line.visible.strike-col-1 { height: 90%; }
      .strike-col-2 { top: 5%; left: 50%; transform: translateX(-50%); width: 8px; height: 0; transform-origin: top center; }
      #strike-line.visible.strike-col-2 { height: 90%; }
      .strike-col-3 { top: 5%; left: 83.3%; transform: translateX(-50%); width: 8px; height: 0; transform-origin: top center; }
      #strike-line.visible.strike-col-3 { height: 90%; }
      .strike-diag-1 { top: 0; left: 0; width: 0; height: 8px; transform: rotate(45deg); transform-origin: 0 0; }
      #strike-line.visible.strike-diag-1 { width: 141.4%; }
      .strike-diag-2 { top: 0; right: 0; width: 0; height: 8px; transform: rotate(-45deg); transform-origin: 100% 0; }
      #strike-line.visible.strike-diag-2 { width: 141.4%; }


      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 200;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(5px);
      }
      .modal-overlay.active {
        display: flex;
      }
      .modal-content {
        background: var(--container-bg);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: var(--text-light);
        padding: 30px;
        border-radius: 20px;
        text-align: center;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        width: 90%;
        max-width: 350px;
        position: relative; 
      }
      
      .modal-close-icon {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 36px;
        height: 36px;
        padding: 0;
        margin: 0;
        background: none;
        border: none;
        cursor: pointer;
        opacity: 0.7;
        transition: opacity 0.2s;
      }
      .modal-close-icon:hover {
        opacity: 1;
      }
      .modal-close-icon .icon {
        width: 24px;
        height: 24px;
        fill: var(--text-light);
      }
      
      .modal-content h2 {
        margin-bottom: 15px;
      }
      .modal-content .modal-body li {
        margin-left: 20px;
        margin-bottom: 10px;
      }
      .modal-content .close-btn,
      .modal-content .action-btn {
        margin-top: 20px;
      }

      .join-id-wrapper {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
      }
      .join-id-prefix {
        padding: 18px 20px;
        background: var(--input-bg);
        color: var(--action-primary);
        font-weight: bold;
        border-top-left-radius: 15px;
        border-bottom-left-radius: 15px;
        font-size: 16px;
      }
      #join-room-input {
        width: 100%;
        background: var(--input-bg);
        border: none;
        border-radius: 0 15px 15px 0;
        padding: 18px 20px;
        font-size: 16px;
        color: var(--text-light);
        margin-bottom: 0;
        letter-spacing: 4px;
        font-weight: bold;
      }
      input[type="number"]::-webkit-inner-spin-button,
      input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      input[type="number"] {
        -moz-appearance: textfield;
      }

      .help-btn {
        position: absolute;
        bottom: 30px;
        right: 30px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--secondary-bg);
        z-index: 100;
        border: none;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        font-size: 28px;
        font-weight: bold;
        color: var(--text-light);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }
    </style>
  </head>
  <body>
    <svg style="display: none">
      <symbol id="svg-back" viewBox="0 0 24 24">
        <path
          class="svg-path"
          d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"
        ></path>
      </symbol>
      <symbol id="svg-home" viewBox="0 0 24 24">
        <path class="svg-path" d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path>
      </symbol>
      <symbol id="svg-kick" viewBox="0 0 24 24">
        <path
          class="svg-path"
          d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"
        ></path>
      </symbol>
      <symbol id="svg-close" viewBox="0 0 24 24">
        <path class="svg-path" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path>
      </symbol>
    </svg>

    <div id="app-container" class="app-container">
      <div id="home-card" class="card active">
        <header class="card-header">
          <a href="https://odiagames.site/" class="back-btn"
            ><svg class="icon"><use xlink:href="#svg-back"></use></svg></a
          ><button id="lang-switch-home" class="lang-switch"></button>
        </header>
        <main class="card-body">
          <h1 data-lang-key="game_title"></h1>
          <button id="single-phone-btn" class="btn-tertiary" data-lang-key="single_phone_play"></button
          ><button
            id="create-room-btn"
            class="btn-primary"
            data-lang-key="create_room"
          ></button
          ><button
            id="join-room-btn"
            class="btn-secondary"
            data-lang-key="join_room"
          ></button>
        </main>
      </div>
      <div id="lobby-card" class="card">
        <header class="card-header">
          <a href="https://odiagames.site/" class="back-btn"
            ><svg class="icon"><use xlink:href="#svg-back"></use></svg
          ></a>
          <h2 class="card-title" data-lang-key="lobby"></h2>
        </header>
        <main class="card-body">
          <div id="lobby-room-id-display">
            <span data-lang-key="room_id"></span>:
            <span id="room-id-text"></span>
          </div>
          <div id="player-list"></div>
          <div class="lobby-buttons">
            <button
              id="invite-btn"
              class="btn-primary"
              data-lang-key="invite_friends"
            ></button
            ><button
              id="start-game-btn"
              class="btn-secondary"
              data-lang-key="start_game"
            ></button>
          </div>
        </main>
      </div>
      <div id="game-card" class="card">
        <main class="card-body">
          <div class="game-header"></div>
          <div class="game-main-content">
            <div id="game-grid" class="tic-tac-toe-grid"></div>
            <div id="game-result-text"></div>
          </div>
          <div class="game-footer"></div>
        </main>
      </div>
      <button id="help-btn" class="help-btn">?</button>
    </div>

    <div id="how-to-play-modal" class="modal-overlay">
      <div class="modal-content">
        <button class="modal-close-icon">
            <svg class="icon"><use xlink:href="#svg-close"></use></svg>
        </button>
        <h2 data-lang-key="how_to_play_title"></h2>
        <div id="how-to-play-content" class="modal-body"></div>
        <button
          id="close-help-modal-btn"
          class="close-btn btn-primary"
          data-lang-key="close"
        ></button>
      </div>
    </div>
    <div id="join-room-modal" class="modal-overlay">
      <div class="modal-content">
        <button class="modal-close-icon">
            <svg class="icon"><use xlink:href="#svg-close"></use></svg>
        </button>
        <h2 data-lang-key="join_room_title"></h2>
        <div class="join-id-wrapper">
          <span class="join-id-prefix">SB</span
          ><input
            type="number"
            id="join-room-input"
            placeholder="0000"
            maxlength="4"
          />
        </div>
        <button
          id="confirm-join-btn"
          class="action-btn btn-primary"
          data-lang-key="join"
        ></button
        ><button
          id="cancel-join-btn"
          class="action-btn btn-tertiary"
          data-lang-key="cancel"
        ></button>
      </div>
    </div>
    <div id="enter-name-modal" class="modal-overlay">
      <div class="modal-content">
        <button class="modal-close-icon">
            <svg class="icon"><use xlink:href="#svg-close"></use></svg>
        </button>
        <h2 data-lang-key="enter_name_title"></h2>
        <input
          type="text"
          class="modal-input"
          id="enter-name-input"
          data-lang-placeholder="your_name"
        /><button
          id="confirm-name-btn"
          class="action-btn btn-primary"
          data-lang-key="confirm"
        ></button>
      </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyBA84lL5-sP2ZUyijHtr42GIPQa5PA3paI",
        authDomain: "odia-tic-tac-toe.firebaseapp.com",
        databaseURL:
          "https://odia-tic-tac-toe-default-rtdb.asia-southeast1.firebasedatabase.app", 
        projectId: "odia-tic-tac-toe",
        storageBucket: "odia-tic-tac-toe.appspot.com",
        messagingSenderId: "803647069044",
        appId: "1:803647069044:web:79f2b9ad3d10b4eae1ea21",
      };
      firebase.initializeApp(firebaseConfig);
      const database = firebase.database();

      let currentPlayer = {},
        currentRoomId = null,
        roomRef = null,
        roomListener = null,
        currentLanguage = "or";
      let localGame = {
        active: false,
        board: [],
        players: [],
        currentPlayerIndex: 0,
        nextStarterOriginalIndex: 0 
      };

      const translations = {
        en: {
          lang_switch_text: "ଓଡ଼ିଆ",
          game_title: "Tic-Tac-Toe",
          create_room: "Create Room (Online)",
          join_room: "Join Room (Online)",
          lobby: "Lobby",
          room_id: "Room ID",
          invite_friends: "Invite Friends",
          start_game: "Start Game",
          waiting_for_player: "Waiting for Player 2...",
          kick: "Kick",
          you_win: "Wins!",
          draw: "It's a Draw!",
          how_to_play_title: "How to Play",
          close: "Close",
          join_room_title: "Enter Room ID",
          enter_name_title: "Enter Your Name",
          confirm: "Confirm",
          join: "Join",
          cancel: "Cancel",
          single_phone_play: "2 Players (Single Phone)",
          player_1_name_prompt: "Enter Player 1 Name (X):",
          player_2_name_prompt: "Enter Player 2 Name (O):",
          your_name: "Your Name",
          how_to_play_html: `<p><strong>Objective:</strong> Be the first player to get 3 of your marks in a row.</p><p><strong>Online Play:</strong></p><ol><li>Click 'Create Room', enter your name.</li><li>Share the Room ID with a friend.</li><li>Your friend clicks 'Join Room', enters the ID and their name.</li></ol><p><strong>Single Phone Play:</strong></p><ol><li>Click '2 Players (Single Phone)'.</li><li>Enter names for Player 1 (X) and Player 2 (O).</li><li>The active player's pod will glow. Pass the phone to play.</li></ol>`,
          invite_message: "Let's play Tic-Tac-Toe! Join my room:",
        },
        or: {
          lang_switch_text: "English",
          game_title: "ଛେକ ଶୂନ",
          create_room: "ଅନଲାଇନ୍ ରୁମ୍",
          join_room: "ରୁମ୍ ଯୋଗ ଦିଅନ୍ତୁ",
          lobby: "ଲବି",
          room_id: "ରୁମ୍ ଆଇଡି",
          invite_friends: "ବନ୍ଧୁଙ୍କୁ ନିମନ୍ତ୍ରଣ କରନ୍ତୁ",
          start_game: "ଖେଳ ଆରମ୍ଭ କରନ୍ତୁ",
          waiting_for_player: "ଖେଳାଳି ୨ ପାଇଁ ଅପେକ୍ଷା...",
          kick: "ବାହାର କରନ୍ତୁ",
          you_win: "ଜିତିଗଲେ!",
          draw: "ଏହା ଏକ ଡ୍ର!",
          how_to_play_title: "କିପରି ଖେଳିବେ",
          close: "ବନ୍ଦ କରନ୍ତୁ",
          join_room_title: "ରୁମ୍ ଆଇଡି ଦିଅନ୍ତୁ",
          enter_name_title: "ଆପଣଙ୍କ ନାମ ଦିଅନ୍ତୁ",
          confirm: "ନିଶ୍ଚିତ କରନ୍ତୁ",
          join: "ଯୋଗ ଦିଅନ୍ତୁ",
          cancel: "ବାତିଲ କରନ୍ତୁ",
          single_phone_play: "୨ ଖେଳାଳି (ଏକକ ଫୋନ୍)",
          player_1_name_prompt: "ଖେଳାଳି ୧ ନାମ ଦିଅନ୍ତୁ (X):",
          player_2_name_prompt: "ଖେଳାଳି ୨ ନାମ ଦିଅନ୍ତୁ (O):",
          your_name: "ଆପଣଙ୍କ ନାମ",
          how_to_play_html: `<p><strong>ଉଦ୍ଦେଶ୍ୟ:</strong> ଧାଡ଼ିରେ ୩ଟି ଚିହ୍ନ ପାଇବାରେ ପ୍ରଥମ ଖେଳାଳି ହୁଅନ୍ତୁ।</p><p><strong>ଅନଲାଇନ୍ ଖେଳ:</strong></p><ol><li>'ଅନଲାଇନ୍ ରୁମ୍' କ୍ଲିକ୍ କରି ନିଜ ନାମ ଦିଅନ୍ତୁ।</li><li>ବନ୍ଧୁଙ୍କୁ ରୁମ୍ ଆଇଡି ପଠାନ୍ତୁ।</li><li>ସେ 'ରୁମ୍ ଯୋଗ ଦିଅନ୍ତୁ' କ୍ଲିକ୍ କରି ଆଇଡି ଓ ନିଜ ନାମ ଦେବେ।</li></ol><p><strong>ଏକକ ଫୋନ୍ ଖେଳ:</strong></p><ol><li>'୨ ଖେଳାଳି (ଏକକ ଫୋନ୍)' କ୍ଲିକ୍ କରନ୍ତୁ।</li><li>ଖେଳାଳି ୧ (X) ଏବଂ ଖେଳାଳି ୨ (O)ଙ୍କ ନାମ ଦିଅନ୍ତୁ।</li><li>ସକ୍ରିୟ ଖେଳାଳିଙ୍କ ପଡ୍ ଚମକିବ। ଫୋନ୍ ପାସ୍ କରି ଖେଳନ୍ତୁ।</li></ol>`,
          invite_message: "ଆସନ୍ତୁ ଛେକ ଶୂନ ଖେଳିବା! ମୋ ରୁମ୍ ରେ ଯୋଗ ଦିଅନ୍ତୁ:",
        },
      };

      const appContainer = document.getElementById("app-container"),
        cards = document.querySelectorAll(".card"),
        createRoomBtn = document.getElementById("create-room-btn"),
        joinRoomBtn = document.getElementById("join-room-btn"),
        lobbyCard = document.getElementById("lobby-card"),
        roomIdText = document.getElementById("room-id-text"),
        playerList = document.getElementById("player-list"),
        inviteBtn = document.getElementById("invite-btn"),
        startGameBtn = document.getElementById("start-game-btn"),
        gameGrid = document.getElementById("game-grid"),
        langSwitches = [document.getElementById("lang-switch-home")],
        helpBtn = document.getElementById("help-btn"),
        singlePhoneBtn = document.getElementById("single-phone-btn"),
        gameHeader = document.querySelector("#game-card .game-header"),
        gameResultText = document.getElementById("game-result-text");
      const helpModal = document.getElementById("how-to-play-modal"),
        closeHelpModalBtn = document.getElementById("close-help-modal-btn"),
        howToPlayContent = document.getElementById("how-to-play-content");
      const joinModal = document.getElementById("join-room-modal"),
        joinRoomInput = document.getElementById("join-room-input"),
        confirmJoinBtn = document.getElementById("confirm-join-btn"),
        cancelJoinBtn = document.getElementById("cancel-join-btn");
      const nameModal = document.getElementById("enter-name-modal"),
        nameInput = document.getElementById("enter-name-input"),
        confirmNameBtn = document.getElementById("confirm-name-btn");

      function switchLanguage(lang) {
        currentLanguage = lang;
        document.documentElement.lang = lang;
        document.querySelectorAll("[data-lang-key]").forEach((el) => {
          const key = el.getAttribute("data-lang-key");
          if (translations[lang][key]) el.textContent = translations[lang][key];
        });
        document.querySelectorAll("[data-lang-placeholder]").forEach((el) => {
          const key = el.getAttribute("data-lang-placeholder");
          if (translations[lang][key]) el.placeholder = translations[lang][key];
        });
        langSwitches.forEach(
          (btn) => (btn.textContent = translations[lang].lang_switch_text)
        );
      }

      function showCard(cardId) {
        cards.forEach((c) => c.classList.remove("active"));
        document.getElementById(cardId).classList.add("active");
      }
      function generateId(prefix, length) {
        const chars = "0123456789";
        let result = "";
        for (let i = 0; i < length; i++) {
          result += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return prefix + result;
      }
      
      async function promptForName(titleKey) {
        return new Promise((resolve) => {
          nameModal.querySelector("h2").setAttribute("data-lang-key", titleKey);
          switchLanguage(currentLanguage);
          nameModal.classList.add("active");
          appContainer.classList.add("blurred");

          const closeIconBtn = nameModal.querySelector('.modal-close-icon');

          const cleanup = () => {
            confirmNameBtn.removeEventListener('click', onConfirm);
            closeIconBtn.removeEventListener('click', onCancel);
            nameModal.classList.remove("active");
            appContainer.classList.remove("blurred");
            nameInput.value = "";
          }

          const onConfirm = () => {
            const name = nameInput.value.trim();
            if (name) {
              cleanup();
              resolve(name);
            }
          };
          
          const onCancel = () => {
            cleanup();
            resolve(null); 
          }

          confirmNameBtn.addEventListener('click', onConfirm);
          closeIconBtn.addEventListener('click', onCancel);
        });
      }

      async function handleCreateRoom() {
        try {
          const name = await promptForName("enter_name_title");
          if (!name) return;

          currentPlayer = { id: generateId("P", 10), name: name };
          currentRoomId = generateId("SB", 4);
          roomRef = database.ref("rooms/" + currentRoomId);
          const roomData = {
            adminId: currentPlayer.id,
            players: {
              [currentPlayer.id]: { name: currentPlayer.name, symbol: "X" },
            },
            gameState: {
              board: Array(9).fill(""),
              currentPlayerId: currentPlayer.id,
              status: "waiting",
            },
            scores: { [currentPlayer.id]: 0 },
            starterOfTheRoundId: currentPlayer.id,
          };

          await roomRef.set(roomData);
          listenToRoomUpdates();
          showCard("lobby-card");
        } catch (error) {
          console.error("CRITICAL ERROR in handleCreateRoom: ", error);
          alert("Failed to create room. Firebase Error: " + error.message);
        }
      }

      async function handleJoinRoom(roomIdToJoin) {
        const finalRoomId = roomIdToJoin.toUpperCase();
        try {
          const roomSnapshot = await database.ref("rooms/" + finalRoomId).get();
          if (!roomSnapshot.exists()) {
            alert("Room not found");
            return;
          }
          const roomData = roomSnapshot.val();
          if (Object.keys(roomData.players || {}).length >= 2) {
            alert("Room is full");
            return;
          }

          const name = await promptForName("enter_name_title");
          if (!name) return;

          currentPlayer = { id: generateId("P", 10), name: name };
          currentRoomId = finalRoomId;
          roomRef = database.ref("rooms/" + currentRoomId);
          const playerSymbol =
            Object.keys(roomData.players || {}).length === 0 ? "X" : "O";
          await roomRef
            .child("players/" + currentPlayer.id)
            .set({ name: currentPlayer.name, symbol: playerSymbol });
          await roomRef.child("scores/" + currentPlayer.id).set(0);

          listenToRoomUpdates();
          showCard("lobby-card");
        } catch (error) {
          console.error("Join Room Failed: ", error);
          alert("Could not join room. " + error.message);
        }
      }

      function listenToRoomUpdates() {
        if (roomListener) roomRef.off("value", roomListener);
        roomListener = roomRef.on("value", (snapshot) => {
          if (!snapshot.exists()) {
            if (currentRoomId) {
              cleanUpAndGoHome(true);
            }
            return;
          }
          const roomData = snapshot.val();
          if (!roomData.players || !roomData.players[currentPlayer.id]) {
            cleanUpAndGoHome(true);
            return;
          }
          updateOnlineUI(roomData);
        });
      }

      function updateOnlineUI(d) {
        localGame.active = false;
        if (
          d.gameState.status === "playing" ||
          d.gameState.status === "finished"
        ) {
          showCard("game-card");
          updateOnlineGameScreen(d);
        } else {
          showCard("lobby-card");
          updateLobbyScreen(d);
        }
      }

      function updateLobbyScreen(d) {
        roomIdText.textContent = currentRoomId;
        const isAdmin = d.adminId === currentPlayer.id;
        playerList.innerHTML = "";
        Object.entries(d.players || {}).forEach(([id, p]) => {
          const li = document.createElement("div");
          li.className = "player-item";
          li.innerHTML = `<span>${p.name} ${p.symbol === "X" ? "(X)" : "(O)"} ${
            d.adminId === id ? "(Admin)" : ""
          }</span> ${
            isAdmin && id !== currentPlayer.id
              ? `<button class="kick-btn" onclick="kickPlayer('${id}')"><svg class="icon" style="fill: #ff4d4d;"><use xlink:href="#svg-kick"></use></svg></button>`
              : ""
          }`;
          playerList.appendChild(li);
        });
        if (Object.keys(d.players || {}).length < 2) {
          const li = document.createElement("div");
          li.className = "player-item";
          li.innerHTML = `<span>${translations[currentLanguage].waiting_for_player}</span>`;
          playerList.appendChild(li);
        }
        startGameBtn.disabled = Object.keys(d.players || {}).length < 2;
      }
      
      function renderPlayerPods(p1Name, p1Score, p2Name, p2Score, p1Active, p2Active, isGameOver) {
        const gameFooter = document.querySelector('#game-card .game-footer');
        
        gameHeader.innerHTML = '';
        if(gameFooter) gameFooter.innerHTML = '';

        const homeBtn = document.createElement('button');
        homeBtn.className = 'back-btn';
        homeBtn.id = 'game-back-btn';
        homeBtn.innerHTML = `<svg class="icon"><use xlink:href="#svg-home"></use></svg>`;
        homeBtn.onclick = (e) => {
            e.preventDefault();
            cleanUpAndGoHome();
        };
        gameHeader.appendChild(homeBtn);

        if(gameFooter){
            const p1Pod = document.createElement("div");
            p1Pod.className = "player-pod p1";
            const p2Pod = document.createElement("div");
            p2Pod.className = "player-pod p2";
            
            p1Pod.innerHTML = `<div class="player-name">${p1Name} (X)</div><div class="player-score">${p1Score}</div>`;
            p2Pod.innerHTML = `<div class="player-name">${p2Name} (O)</div><div class="player-score">${p2Score}</div>`;
            
            p1Pod.classList.toggle("active", p1Active && !isGameOver);
            p2Pod.classList.toggle("active", p2Active && !isGameOver);
            
            gameFooter.appendChild(p1Pod);
            gameFooter.appendChild(p2Pod);
        }
      }

      function updateOnlineGameScreen(d) {
        const playerX = Object.values(d.players).find(p => p.symbol === 'X') || {name: 'Player X', score: 0};
        const playerO = Object.values(d.players).find(p => p.symbol === 'O') || {name: 'Player O', score: 0};
        const playerXId = Object.keys(d.players).find(id => d.players[id].symbol === 'X');
        const playerOId = Object.keys(d.players).find(id => d.players[id].symbol === 'O');

        renderPlayerPods(
          playerX.name,
          d.scores[playerXId] || 0,
          playerO.name,
          d.scores[playerOId] || 0,
          d.gameState.currentPlayerId === playerXId,
          d.gameState.currentPlayerId === playerOId,
          d.gameState.status !== "playing"
        );
        
        gameGrid.innerHTML = ``;
        d.gameState.board.forEach((cell, idx) => {
          const el = document.createElement("div");
          el.classList.add("cell");
          el.textContent = cell;
          if (
            cell === "" &&
            d.gameState.status === "playing" &&
            d.gameState.currentPlayerId === currentPlayer.id
          ) {
            el.onclick = () => handleOnlineCellClick(idx, d);
          } else {
            el.style.cursor = "default";
          }
          gameGrid.appendChild(el);
        });
        const strikeLineDiv = document.createElement('div');
        strikeLineDiv.id = 'strike-line';
        gameGrid.appendChild(strikeLineDiv);
        
        if (d.gameState.status === "finished") {
          const { winner, winningLine, lineClass } = d.gameState;
          gameResultText.textContent = winner
            ? `${d.players[winner].name} ${translations[currentLanguage].you_win}`
            : translations[currentLanguage].draw;
          if (winningLine) {
            winningLine.forEach((i) =>
              gameGrid.children[i].classList.add("win")
            );
            strikeLineDiv.className = lineClass;
            setTimeout(() => { strikeLineDiv.classList.add('visible'); }, 50);
          }
          
          if (d.adminId === currentPlayer.id) {
            setTimeout(() => {
                const lastStarterId = d.starterOfTheRoundId || d.adminId;
                const otherPlayerId = Object.keys(d.players).find(id => id !== lastStarterId);
                
                if (!otherPlayerId || Object.keys(d.players).length < 2) return;
                
                const nextStarterId = otherPlayerId;

                if (confirm(`Play again?`)) {
                    const updates = {
                        '/gameState': {
                            board: Array(9).fill(""),
                            currentPlayerId: nextStarterId,
                            status: "playing",
                            winner: null, winningLine: null, lineClass: null
                        },
                        '/starterOfTheRoundId': nextStarterId,
                        [`/players/${nextStarterId}/symbol`]: 'X',
                        [`/players/${lastStarterId}/symbol`]: 'O'
                    };
                    roomRef.update(updates);
                }
            }, 2500);
          }
        } else {
          gameResultText.textContent = "";
        }
      }

      function handleOnlineCellClick(idx, d) {
        const sym = d.players[currentPlayer.id].symbol;
        const board = [...d.gameState.board];
        board[idx] = sym;
        const { hasWon, winningLine, lineClass } = checkWin(board, sym);
        const isDraw = !hasWon && board.every((c) => c !== "");
        const oppId = Object.keys(d.players).find(
          (id) => id !== currentPlayer.id
        );
        const gs = {
          board,
          currentPlayerId: hasWon || isDraw ? null : oppId,
          status: hasWon || isDraw ? "finished" : "playing",
          winner: hasWon ? currentPlayer.id : null,
          winningLine: hasWon ? winningLine : null,
          lineClass: hasWon ? lineClass : null,
        };
        const updates = { "/gameState": gs };
        if (hasWon) {
          updates[`/scores/${currentPlayer.id}`] =
            (d.scores[currentPlayer.id] || 0) + 1;
        }
        roomRef.update(updates);
      }

      function startLocalGame() {
        localGame.active = true;
        const p1Name =
          prompt(
            translations[currentLanguage].player_1_name_prompt,
            "Player 1"
          ) || "Player 1";
        const p2Name =
          prompt(
            translations[currentLanguage].player_2_name_prompt,
            "Player 2"
          ) || "Player 2";
        
        localGame.players = [
          { name: p1Name, score: 0, originalIndex: 0 },
          { name: p2Name, score: 0, originalIndex: 1 },
        ];
        localGame.nextStarterOriginalIndex = 0;
        
        resetLocalBoard(localGame.nextStarterOriginalIndex);
        showCard("game-card");
      }
      
      function updateLocalGameUI() {
        renderPlayerPods(
          localGame.players[0].name,
          localGame.players[0].score,
          localGame.players[1].name,
          localGame.players[1].score,
          localGame.currentPlayerIndex === 0,
          localGame.currentPlayerIndex === 1,
          localGame.gameOver
        );
        
        gameGrid.innerHTML = ``;
        localGame.board.forEach((cell, idx) => {
          const el = document.createElement("div");
          el.classList.add("cell");
          el.textContent = cell;
          if (cell === "" && !localGame.gameOver) {
            el.onclick = () => handleLocalCellClick(idx);
          } else {
            el.style.cursor = "default";
          }
          gameGrid.appendChild(el);
        });
        const strikeLineDiv = document.createElement('div');
        strikeLineDiv.id = 'strike-line';
        gameGrid.appendChild(strikeLineDiv);
      }
      
      function handleLocalCellClick(idx) {
        if (localGame.gameOver || localGame.board[idx] !== '') return;

        const symbol = localGame.currentPlayerIndex === 0 ? "X" : "O";
        localGame.board[idx] = symbol;
        gameGrid.children[idx].textContent = symbol;
        
        const { hasWon, winningLine, lineClass } = checkWin(localGame.board, symbol);
        const isDraw = !hasWon && localGame.board.every((c) => c !== "");
        
        if (hasWon) {
          localGame.gameOver = true;
          const p = localGame.players[localGame.currentPlayerIndex];
          p.score++;
          gameResultText.textContent = `${p.name} ${translations[currentLanguage].you_win}`;
          
          const strikeLine = gameGrid.querySelector('#strike-line');
          if (winningLine) {
            winningLine.forEach((i) =>
              gameGrid.children[i].classList.add("win")
            );
            strikeLine.className = lineClass;
            setTimeout(() => { strikeLine.classList.add('visible'); }, 50);
          }
          
          renderPlayerPods(localGame.players[0].name, localGame.players[0].score, localGame.players[1].name, localGame.players[1].score, false, false, true);

          setTimeout(() => {
            localGame.nextStarterOriginalIndex = 1 - localGame.nextStarterOriginalIndex;
            resetLocalBoard(localGame.nextStarterOriginalIndex);
          }, 2500);

        } else if (isDraw) {
          localGame.gameOver = true;
          gameResultText.textContent = translations[currentLanguage].draw;
          setTimeout(() => {
             localGame.nextStarterOriginalIndex = 1 - localGame.nextStarterOriginalIndex;
             resetLocalBoard(localGame.nextStarterOriginalIndex);
          }, 2500);

        } else {
          localGame.currentPlayerIndex = 1 - localGame.currentPlayerIndex;
          renderPlayerPods(localGame.players[0].name, localGame.players[0].score, localGame.players[1].name, localGame.players[1].score, localGame.currentPlayerIndex === 0, localGame.currentPlayerIndex === 1, false);
        }
      }

      function resetLocalBoard(startingPlayerOriginalIndex) {
        if (localGame.players.length > 0 && localGame.players[0].originalIndex !== startingPlayerOriginalIndex) {
            [localGame.players[0], localGame.players[1]] = [localGame.players[1], localGame.players[0]];
        }
        
        gameResultText.textContent = "";
        localGame.board = Array(9).fill("");
        localGame.gameOver = false;
        localGame.currentPlayerIndex = 0;
        updateLocalGameUI();
      }
      
      function checkWin(b, s) {
        const lines = [
          [0, 1, 2], [3, 4, 5], [6, 7, 8],
          [0, 3, 6], [1, 4, 7], [2, 5, 8],
          [0, 4, 8], [2, 4, 6]
        ];
        const lineClasses = [
          "strike-row-1", "strike-row-2", "strike-row-3",
          "strike-col-1", "strike-col-2", "strike-col-3",
          "strike-diag-1", "strike-diag-2"
        ];
        for (let i = 0; i < lines.length; i++) {
          const [a, c, d] = lines[i];
          if (b[a] === s && b[c] === s && b[d] === s)
            return { hasWon: true, winningLine: lines[i], lineClass: lineClasses[i] };
        }
        return { hasWon: false, winningLine: null, lineClass: null };
      }

      function cleanUpAndGoHome(wasKickedOrClosed = false) {
        if (wasKickedOrClosed && currentRoomId) {
          alert("The room was closed or you were kicked.");
        }
        if (roomListener && roomRef) {
          roomRef.off("value", roomListener);
        }
        currentRoomId = null;
        roomRef = null;
        roomListener = null;
        localGame.active = false;
        currentPlayer = {};
        showCard("home-card");
      }

      function kickPlayer(pId) {
        if (
          !confirm(
            currentLanguage === "or"
              ? "ଆପଣ ଏହି ଖେଳାଳିଙ୍କୁ ବାହାର କରିବାକୁ ନିଶ୍ଚିତ କି?"
              : "Are you sure?"
          )
        )
          return;
        roomRef.update({ [`/players/${pId}`]: null, [`/scores/${pId}`]: null });
      }

      window.addEventListener("DOMContentLoaded", () => {
        switchLanguage("or");
        const urlParams = new URLSearchParams(window.location.search);
        const roomFromUrl = urlParams.get("room");
        if (
          roomFromUrl &&
          roomFromUrl.startsWith("SB") &&
          roomFromUrl.length === 6
        ) {
          joinModal.classList.add("active");
          appContainer.classList.add("blurred");
          joinRoomInput.value = roomFromUrl.slice(2);
        }

        document.querySelectorAll('#how-to-play-modal .modal-close-icon, #join-room-modal .modal-close-icon').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const modal = e.currentTarget.closest('.modal-overlay');
                if (modal) {
                    modal.classList.remove('active');
                    appContainer.classList.remove('blurred');
                    if (modal.id === 'join-room-modal') {
                        joinRoomInput.value = '';
                    }
                }
            });
        });
      });

      langSwitches.forEach(
        (b) =>
          (b.onclick = () =>
            switchLanguage(currentLanguage === "or" ? "en" : "or"))
      );
      createRoomBtn.onclick = handleCreateRoom;
      singlePhoneBtn.onclick = startLocalGame;
      inviteBtn.onclick = () => {
        const m = `${translations[currentLanguage].invite_message}\nhttps://odiagames.site/ttt/?room=${currentRoomId}`;
        window.open(
          `https://api.whatsapp.com/send?text=${encodeURIComponent(m)}`,
          "_blank"
        );
      };
      startGameBtn.onclick = () =>
        roomRef.child("gameState/status").set("playing");

      helpBtn.onclick = () => {
        howToPlayContent.innerHTML =
          translations[currentLanguage].how_to_play_html;
        helpModal.classList.add("active");
        appContainer.classList.add("blurred");
      };
      closeHelpModalBtn.onclick = () => {
        helpModal.classList.remove("active");
        appContainer.classList.remove("blurred");
      };

      joinRoomBtn.onclick = () => {
        joinModal.classList.add("active");
        appContainer.classList.add("blurred");
      };
      cancelJoinBtn.onclick = () => {
        joinModal.classList.remove("active");
        appContainer.classList.remove("blurred");
        joinRoomInput.value = "";
      };
      confirmJoinBtn.onclick = () => {
        const roomId = "SB" + joinRoomInput.value;
        if (joinRoomInput.value.length === 4) {
          cancelJoinBtn.click();
          handleJoinRoom(roomId);
        } else {
          alert("Please enter a 4-digit room code.");
        }
      };
    </script>
  </body>
</html>
