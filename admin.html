<!-- admin.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - My Odia Games</title>
    <style>
        body { font-family: sans-serif; background-color: #f4f4f9; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1, h2 { color: #0A2463; }
        #login-section, #admin-section { display: none; }
        input, textarea, button { width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box; }
        button { background-color: #00693f; color: white; border: none; cursor: pointer; font-weight: bold; }
        button:hover { background-color: #004d2b; }
        #logout-btn { background-color: #d9534f; }
        #logout-btn:hover { background-color: #c9302c; }
        .game-list-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; }
        .game-list-item button { width: auto; padding: 5px 10px; background-color: #e68a00;}
    </style>
</head>
<body>

    <div class="container">
        <h1>Admin Panel</h1>

        <!-- Login Form -->
        <div id="login-section">
            <h2>Login</h2>
            <input type="email" id="email" placeholder="Email">
            <input type="password" id="password" placeholder="Password">
            <button id="login-btn">Login</button>
            <p id="login-error" style="color: red;"></p>
        </div>

        <!-- Admin Content (Add/List Games) -->
        <div id="admin-section">
            <p>Welcome, <span id="admin-email"></span>! <button id="logout-btn">Logout</button></p>
            
            <hr>

            <h2>Add New Game</h2>
            <form id="add-game-form">
                <input type="text" id="title_en" placeholder="Game Title (English)" required>
                <input type="text" id="title_or" placeholder="Game Title (Odia)" required>
                <textarea id="desc_en" placeholder="Description (English)" required></textarea>
                <textarea id="desc_or" placeholder="Description (Odia)" required></textarea>
                <input type="url" id="iconUrl" placeholder="Icon Image URL" required>
                <input type="url" id="gameUrl" placeholder="Game Link URL (e.g., /bingo)" required>
                <input type="number" id="order" placeholder="Display Order (e.g., 1, 2, 3)" required>
                <label><input type="checkbox" id="isNew" style="width: auto;"> Mark as "New"?</label>
                <button type="submit">Add Game</button>
            </form>

            <hr>

            <h2>Existing Games</h2>
            <div id="game-list"></div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        // Use the same config as your index.html
        const firebaseConfig = { apiKey: "AIzaSyCI8CEVsIm04yshvJVAZqQcElE_G-VaduQ", authDomain: "odia-games-visitor-counter.firebaseapp.com", projectId: "odia-games-visitor-counter", storageBucket: "odia-games-visitor-counter.firebasestorage.app", messagingSenderId: "485616496841", appId: "1:485616496841:web:554cb48f6ec2182caa1d18"};
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        const loginSection = document.getElementById('login-section');
        const adminSection = document.getElementById('admin-section');
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const addGameForm = document.getElementById('add-game-form');
        const gameList = document.getElementById('game-list');
        const adminEmail = document.getElementById('admin-email');
        const loginError = document.getElementById('login-error');

        // Check user's auth state
        auth.onAuthStateChanged(user => {
            if (user) {
                // User is signed in
                loginSection.style.display = 'none';
                adminSection.style.display = 'block';
                adminEmail.textContent = user.email;
                loadGames();
            } else {
                // User is signed out
                loginSection.style.display = 'block';
                adminSection.style.display = 'none';
            }
        });

        // Login
        loginBtn.addEventListener('click', () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            auth.signInWithEmailAndPassword(email, password)
                .catch(error => {
                    console.error("Login Error:", error);
                    loginError.textContent = error.message;
                });
        });

        // Logout
        logoutBtn.addEventListener('click', () => {
            auth.signOut();
        });

        // Add a new game
        addGameForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const newGame = {
                title_en: document.getElementById('title_en').value,
                title_or: document.getElementById('title_or').value,
                desc_en: document.getElementById('desc_en').value,
                desc_or: document.getElementById('desc_or').value,
                iconUrl: document.getElementById('iconUrl').value,
                gameUrl: document.getElementById('gameUrl').value,
                order: Number(document.getElementById('order').value),
                isNew: document.getElementById('isNew').checked,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                await db.collection('games').add(newGame);
                addGameForm.reset();
                alert('Game added successfully!');
                loadGames(); // Refresh the list
            } catch (error) {
                console.error("Error adding game: ", error);
                alert('Error adding game. Check console for details.');
            }
        });

        // Load and display existing games
        async function loadGames() {
            gameList.innerHTML = 'Loading...';
            const snapshot = await db.collection('games').orderBy('order', 'asc').get();
            gameList.innerHTML = '';
            snapshot.forEach(doc => {
                const game = doc.data();
                const item = document.createElement('div');
                item.className = 'game-list-item';
                item.innerHTML = `
                    <span><strong>${game.order}. ${game.title_en}</strong> (${game.title_or})</span>
                    <button data-id="${doc.id}">Delete</button>
                `;
                gameList.appendChild(item);
            });
        }

        // Delete a game
        gameList.addEventListener('click', async (e) => {
            if (e.target.tagName === 'BUTTON' && e.target.dataset.id) {
                const gameId = e.target.dataset.id;
                if (confirm('Are you sure you want to delete this game?')) {
                    try {
                        await db.collection('games').doc(gameId).delete();
                        alert('Game deleted!');
                        loadGames(); // Refresh list
                    } catch (error) {
                        console.error("Error deleting game: ", error);
                        alert('Error deleting game. Check console.');
                    }
                }
            }
        });

    </script>
</body>
</html>
