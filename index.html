<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#f4f7fc" />
    <title>Odia Games</title>
    <!-- My Odia Games | ମୋ ଓଡ଼ିଆ ଖେଳ | ସନ୍ଦୀପ୍ ବିଶ୍ବାଳ ଜି | Sandeep Biswal G | संदीप् बिश्वाल जी -->
    <meta
      name="description"
      content="Play the best collection of Odia games online! Challenge your mind with single-player games like Knowledge Test and Math Wizard, or compete with friends in multiplayer games like Tic Tac Toe, Bingo, and Math Game Room."
    />
    <meta name="google-site-verification" content="voV2lK4lf9DbpZvVmeb865BDnmE4O9F3SrVhBNg1eS4"/>
    <link rel="canonical" href="https://odiagames.site/" />
    <meta property="og:title" content="Odia Games | ଓଡ଼ିଆ ଖେଳ" />
    <meta property="og:description" content="Play the best collection of single-player and multiplayer Odia games online for free." />
    <meta property="og:image" content="https://odiagames.site/odiagames.png" />
    <meta property="og:url" content="https://odiagames.site/" />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Odia Games | ଓଡ଼ିଆ ଖେଳ" />
    <meta name="twitter:description" content="Play the best collection of single-player and multiplayer Odia games online for free." />
    <meta name="twitter:image" content="https://odiagames.site/odiagames.png" />
    <meta name="twitter:site" content="@sandeepbiswalg" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Oriya:wght@400;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
    <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "Odia Games",
  "alternateName": "OdiaGames.site",
  "url": "https://odiagames.site",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://odiagames.site/search?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
    </script>
      <style>
      :root {--bg-color: #f4f7fc;--card-color: #ffffff;--text-color: #1c1c1e;--sub-text-color: #6c757d;--primary-color: #0a2463;--accent-color1: #e3d8f4;--accent-color2: #d3edd4;--shadow: 0 10px 30px rgba(0, 0, 0, 0.07);}
      * {margin: 0;padding: 0;box-sizing: border-box;}
      html {scroll-behavior: smooth;}
      body {font-family: "Poppins", sans-serif;background-color: var(--bg-color);color: var(--text-color);line-height: 1.6;display: flex;flex-direction: column;min-height: 100vh;}
      body.or-lang, body.od_en-lang, body.hi_en-lang {font-family: "Noto Sans Oriya", "Poppins", sans-serif;}
      .container {max-width: 1200px;margin: 0 auto;padding: 0 20px;}
      main {flex-grow: 1;padding-top: 2rem;}
      header {padding: 1.25rem 0;position: sticky;top: 0;z-index: 1000;background-color: rgba(244, 247, 252, 0.85);backdrop-filter: blur(10px);-webkit-backdrop-filter: blur(10px);border-bottom: 1px solid rgba(0, 0, 0, 0.05);}
      .header-content {display: flex;justify-content: space-between;align-items: center;}
      .header-left {font-size: 1.5rem;font-weight: 700;text-decoration: none;color: var(--text-color);}
      .header-right {display: flex;align-items: center;gap: 1rem;}
      .main-nav.desktop-nav {display: flex;align-items: center;gap: 1rem;}
      .main-nav.desktop-nav a {text-decoration: none;color: var(--text-color);font-weight: 500;transition: color 0.3s;padding: 0.5rem;display: flex;align-items: center;gap: 0.5rem;}
      .main-nav.desktop-nav a:hover {color: var(--primary-color);}
      #menu-toggle {background: 0 0;border: 0;cursor: pointer;display: none;z-index: 2001;}
      #menu-toggle svg {width: 28px;height: 28px;}
      .mobile-nav {visibility: hidden;opacity: 0;position: fixed;top: 0;left: 0;width: 100%;height: 100%;background: rgba(26, 26, 30, 0.3);backdrop-filter: blur(5px);-webkit-backdrop-filter: blur(5px);z-index: 2000;transition: opacity 0.3s, visibility 0.3s;}
      .mobile-nav.active {visibility: visible;opacity: 1;}
      .mobile-nav-panel {background: var(--card-color);width: 100%;padding: 1.5rem 1.25rem;box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);display: flex;flex-direction: column;gap: 1rem;border-bottom-left-radius: 1rem;border-bottom-right-radius: 1rem;transform: translateY(-100%);transition: transform 0.3s ease-out;}
      .mobile-nav.active .mobile-nav-panel {transform: translateY(0);}
      .mobile-nav a {font-size: 1.2rem;text-decoration: none;color: var(--text-color);display: flex;align-items: center;gap: 0.75rem;padding: 0.5rem;}
      .lang-switcher { position: relative; }
      .lang-switcher-btn { background-color: var(--primary-color); color: #fff; border: none; padding: 0.5rem 1rem; border-radius: 20px; cursor: pointer; font-size: 0.9rem; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; transition: background-color 0.3s; }
      .lang-switcher-btn:hover { background-color: #081d4f; }
      .lang-switcher-btn i { font-size: 1rem; }
      .lang-dropdown { list-style: none; position: absolute; top: 120%; right: 0; background-color: var(--card-color); border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); padding: 0.5rem 0; z-index: 1001; min-width: 120px; display: none; }
      .lang-dropdown.active { display: block; }
      .lang-dropdown li { padding: 0.75rem 1.25rem; cursor: pointer; transition: background-color 0.2s; }
      .section-header {margin: 3rem 0 1.5rem;}
      .section-title {font-size: 1.8rem;font-weight: 600;}
      .search-container {margin-bottom: 2.5rem;}
      .search-input {width: 100%;padding: 1rem 1.25rem;font-size: 1rem;border: 1px solid #e0e0e0;border-radius: 12px;background: var(--card-color);transition: all 0.2s ease-in-out;}
      .search-input:focus {outline: 0;border-color: var(--primary-color);box-shadow: 0 0 0 3px rgba(10, 36, 99, 0.1);}
      .categories-grid {display: grid;grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));gap: 1.5rem;}
      .category-card {border-radius: 1.5rem;padding: 1.5rem;color: var(--text-color);box-shadow: var(--shadow);transition: transform 0.3s;cursor: pointer;}
      .category-card:hover {transform: translateY(-5px);}
      .category-card.c1 {background-color: var(--accent-color1);}
      .category-card.c2 {background-color: var(--accent-color2);}
      .category-card h3 {font-size: 1.2rem;font-weight: 600;}
      .category-card p {font-size: 1rem;color: var(--sub-text-color);}
      .content-list {display: flex;flex-direction: column;gap: 1rem;margin-top: 1.5rem;}
      .game-card, .ad-card {background-color: var(--card-color);border-radius: 1.5rem;box-shadow: var(--shadow);overflow: hidden;transition: transform 0.3s;text-decoration: none;padding: 1rem;display: flex;align-items: center;gap: 1rem;}
      .html-ad-card { background-color: transparent; box-shadow: none; padding: 0; margin: 1rem 0; }
      .game-card:hover {transform: scale(1.01);}
      .game-icon {width: 50px;height: 50px;border-radius: 0.75rem;object-fit: cover;flex-shrink: 0;}
      .game-card-text {flex-grow: 1;}
      .game-card-text h3 {font-size: 1.1rem;margin: 0 0 0.1rem 0;color: var(--text-color);}
      .game-card-text p {font-size: 0.9rem;color: var(--sub-text-color);margin: 0;}
      .btn-play {text-decoration: none;margin-left: auto;padding: 0.6rem 1.2rem;font-size: 0.9rem;background-color: #1c1c1e;color: #fff;border-radius: 2rem;font-weight: 500;transition: opacity 0.2s;}
      .btn-play:hover {opacity: 0.8;}
      .skeleton {background: #e0e0e0;border-radius: 1rem;animation: shimmer 1.5s infinite ease-in-out;}
      @keyframes shimmer {0% {opacity: 0.8;} 50% {opacity: 0.4;} 100% {opacity: 0.8;}}
      footer {background: var(--bg-color);color: var(--text-color);padding: 2rem 0;text-align: center;margin-top: 4rem;border-top: 1px solid #e0e0e0;}
      footer p {font-weight: bold;}
      .footer-links {margin-top: 1rem;display: flex;justify-content: center;gap: 1.5rem;font-weight: 500;}
      .footer-links a {color: var(--sub-text-color);text-decoration: none;transition: color 0.3s;}
      .footer-links a:hover {color: var(--primary-color);text-decoration: underline;}
      #footer-ad-banner { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); z-index: 2000; display: none; justify-content: center; align-items: center; padding: 10px; box-shadow: 0 -5px 15px rgba(0,0,0,0.2); }
      #footer-ad-banner a { display: block; max-width: 728px; }
      #footer-ad-banner img { max-width: 100%; height: auto; border-radius: 8px; }
      #close-footer-ad { position: absolute; top: 10px; right: 20px; background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 50%; width: 30px; height: 30px; font-size: 1.2rem; cursor: pointer; line-height: 1; }
      .modal {display: none;position: fixed;z-index: 3000;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgba(0, 0, 0, 0.6);}
      .modal-content {background: var(--bg-color);border-radius: 1rem;margin: 5% auto;padding: 2rem;max-width: 90%;width: 600px;position: relative;}
      .close-button {position: absolute;top: 1rem;right: 1.5rem;font-size: 2rem;cursor: pointer;color: #aaa;}
      .close-button:hover {color: #000;}
      @media (max-width: 768px) {.main-nav.desktop-nav {display: none;} #menu-toggle {display: block;} .modal-content {width: 95%;}}
    </style>
</head>
<body class="">
    <header id="main-header">
      <div class="container header-content">
        <a href="/" class="header-left" data-key="logo_text"></a>
        <div class="header-right">
          <nav class="main-nav desktop-nav">
            <a data-key="nav_advertise" href="mailto:message.sbg@gmail.com"></a><a href="/blog/" data-key="nav_blog"></a><a href="/terms/" data-key="nav_termss"></a><a href="/privacy-policy/" data-key="nav_privacys"></a><a href="/about/" data-key="nav_about"></a><a href="https://www.instagram.com/sandeepbiswalg" target="_blank" rel="noopener noreferrer" data-key="nav_follow"><i class="bi bi-instagram"></i><span></span></a>
          </nav>
          <div class="lang-switcher" id="lang-switcher">
              <button class="lang-switcher-btn" id="lang-switcher-btn"><i class="bi bi-translate"></i> <span id="current-lang-text"></span></button>
              <ul class="lang-dropdown" id="lang-dropdown">
              </ul>
          </div>
          <button id="menu-toggle" aria-label="Toggle Menu"><svg id="menu-open-icon" viewBox="0 0 24 24"><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z" fill="currentColor" /></svg><svg id="menu-close-icon" style="display: none" viewBox="0 0 24 24"><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z" fill="currentColor"/></svg></button>
        </div>
      </div>
    </header>
    <nav class="main-nav mobile-nav" id="mobile-nav">
      <div class="mobile-nav-panel">
        <a data-key="nav_advertise" href="mailto:message.sbg@gmail.com"></a><a href="/blog/" data-key="nav_blog"></a><a href="/terms/" data-key="nav_termss"></a><a href="/privacy-policy/" data-key="nav_privacys"></a><a href="/about/" data-key="nav_about"></a><a href="https://www.instagram.com/sandeepbiswalg" target="_blank" rel="noopener noreferrer" data-key="nav_follow"><i class="bi bi-instagram"></i><span></span></a>
      </div>
    </nav>
    <main>
      <div class="container" id="content-container">
        <div id="skeleton-container">
          <div class="search-container"><div class="skeleton" style="height: 50px; border-radius: 12px"></div></div>
          <div class="section-header"><div class="skeleton" style="height: 30px; width: 200px"></div></div>
          <div class="categories-grid"><div class="skeleton" style="height: 100px; border-radius: 1.5rem"></div><div class="skeleton" style="height: 100px; border-radius: 1.5rem"></div></div>
          <div class="section-header" style="margin-top: 2rem"><div class="skeleton" style="height: 30px; width: 250px"></div></div>
          <div class="content-list"><div class="skeleton" style="height: 70px; border-radius: 1.5rem"></div><div class="skeleton" style="height: 70px; border-radius: 1.5rem"></div></div>
        </div>
        <div id="actual-content" style="display: none">
          <div class="search-container"><input type="search" id="search-bar" class="search-input" /></div>
          <div id="featured-game-section" style="display: none">
            <div class="section-header"><h2 class="section-title" data-key="featured_game_title"></h2></div>
            <div id="featured-game-container" class="content-list"></div>
          </div>
          <div id="categories-section" style="display: none;">
            <div class="section-header"><h2 class="section-title" data-key="categories_title"></h2></div>
            <div id="categories-container" class="categories-grid"></div>
          </div>
          <div id="all-games-section">
            <div class="section-header"><h2 class="section-title" data-key="all_games_title"></h2></div>
            <div id="all-games-container" class="content-list"></div>
          </div>
        </div>
      </div>
    </main>
    <footer>
      <div class="container">
        <p data-key="footer_copyright"></p>
        <p style="margin-top: 0.75rem"><span data-key="total_visits_text"></span><span id="visit-count"></span></p>
        <div class="footer-links"><a href="/terms/" data-key="nav_termss"></a><a href="/privacy-policy/" data-key="nav_privacys"></a><a href="/about/" data-key="nav_about"></a></div>
      </div>
    </footer>
    <div id="footer-ad-banner"><button id="close-footer-ad">×</button><div id="footer-ad-content"></div></div>
    <div id="category-modal" class="modal"><div class="modal-content"><span class="close-button">×</span><h1 id="category-modal-title"></h1><div id="category-modal-games" class="content-list"></div></div></div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const firebaseConfig = { apiKey: "AIzaSyCI8CEVsIm04yshvJVAZqQcElE_G-VaduQ", authDomain: "odia-games-visitor-counter.firebaseapp.com", projectId: "odia-games-visitor-counter" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        let allContent = [], appLanguages = {}, currentLang = "en", latestVisitCount = 0;
        
        // --- MODIFIED: This map is now only for PRETTY URLs. It is OPTIONAL. ---
        // If you add a 'hinglish' language with code 'hi_en', you can add 'hi_en: "hinglish"' here.
        const langUrlMap = { en: 'english', or: 'odia', od_en: 'odinglish' };
        
        // --- This will be built dynamically now ---
        let urlLangMap = {};

        const searchBar = document.getElementById("search-bar"), visitCountEl = document.getElementById("visit-count"), featuredGameSection = document.getElementById("featured-game-section"), featuredContainer = document.getElementById("featured-game-container"), categoriesContainer = document.getElementById("categories-container"), categoriesSection = document.getElementById("categories-section"), allGamesContainer = document.getElementById("all-games-container"), skeletonContainer = document.getElementById("skeleton-container"), actualContent = document.getElementById("actual-content"), langSwitcher = document.getElementById('lang-switcher'), langSwitcherBtn = document.getElementById('lang-switcher-btn'), currentLangText = document.getElementById('current-lang-text'), langDropdown = document.getElementById('lang-dropdown'), menuToggle = document.getElementById("menu-toggle"), mobileNav = document.getElementById("mobile-nav"), menuOpen = document.getElementById("menu-open-icon"), menuClose = document.getElementById("menu-close-icon"), categoryModal = document.getElementById("category-modal"), categoryModalTitle = document.getElementById("category-modal-title"), categoryModalGames = document.getElementById("category-modal-games");

        const toOdiaNumerals = (n) => {
            const numStrWithCommas = n.toLocaleString('en-US');
            return numStrWithCommas.split("").map(d => "୦୧୨୩୪୫୬୭୮୯"[d] || d).join("");
        };

        const openModal = m => m.style.display = "block";
        const closeModal = m => m.style.display = "none";
        
        const setLanguage = (langCode) => {
            if (!appLanguages[langCode]) return; 
            currentLang = langCode;
            localStorage.setItem("userLanguage", currentLang);
            document.documentElement.lang = currentLang;
            document.body.className = `${currentLang}-lang`;
            
            const uiStrings = appLanguages[currentLang].ui;
            currentLangText.textContent = appLanguages[currentLang].displayName;

            if (uiStrings && uiStrings.page_title) {
                document.title = uiStrings.page_title;
            }

            document.querySelectorAll("[data-key]").forEach(el => {
                const key = el.dataset.key;
                if (uiStrings && uiStrings[key]) {
                    if (key === "nav_follow") { el.querySelector("span").textContent = " " + uiStrings[key]; } 
                    else { el.textContent = uiStrings[key]; }
                }
            });
            if(searchBar) searchBar.placeholder = (uiStrings && uiStrings.search_placeholder) || "Search...";
            
            if (latestVisitCount > 0) { visitCountEl.textContent = currentLang === "or" ? toOdiaNumerals(latestVisitCount) : latestVisitCount.toLocaleString('en-US'); }
            if (allContent.length > 0) renderAll();
            langDropdown.classList.remove('active');

            // --- MODIFIED: Now uses the language code as a fallback for the URL ---
            const langParam = langUrlMap[langCode] || langCode;
            const currentUrl = new URL(window.location);
            if (currentUrl.searchParams.get('lang') !== langParam) {
                const newUrl = `${window.location.pathname}?lang=${langParam}`;
                window.history.pushState({ lang: langCode }, '', newUrl);
            }
        };
        
        const renderAll = () => {
            const searchTerm = searchBar.value.toLowerCase().trim();
            const games = allContent.filter(i => "game" === i.type);
            
            featuredContainer.innerHTML = "";
            const featuredGames = games.filter(g => g.isFeatured).slice(0, 2);
            if (!searchTerm && featuredGames.length > 0) {
                featuredGames.forEach(game => featuredContainer.appendChild(createGameCard(game)));
                featuredGameSection.style.display = 'block';
            } else {
                featuredGameSection.style.display = 'none';
            }
            
            categoriesContainer.innerHTML = "";
            if (!searchTerm && games.length > 0) {
                const cats = games.reduce((a, g) => {
                    let c = "General";
                    if (g.categories && g.categories[currentLang]) { c = g.categories[currentLang]; } 
                    else if (g.categories && g.categories.en) { c = g.categories.en; } 
                    else if (g[`category_${currentLang}`]) { c = g[`category_${currentLang}`]; } 
                    else { c = g.category_en || "General"; }
                    if(c) (a[c] = a[c] || []).push(g);
                    return a;
                }, {});
                Object.keys(cats).sort().forEach((catName, index) => categoriesContainer.appendChild(createCategoryCard(catName, cats[catName].length, index, () => showCategoryModal(catName, cats[catName]))));
                categoriesSection.style.display = 'block';
            } else {
                categoriesSection.style.display = 'none';
            }

            const filteredContent = searchTerm ? games.filter(g => {
                const titles = g.titles ? Object.values(g.titles).join(' ').toLowerCase() : '';
                const oldTitles = ` ${g.title_en || ''} ${g.title_or || ''} `.toLowerCase();
                return titles.includes(searchTerm) || oldTitles.includes(searchTerm);
            }) : allContent;

            allGamesContainer.innerHTML = "";
            filteredContent.forEach(item => {
                if (item.type === 'game') allGamesContainer.appendChild(createGameCard(item));
                else if (item.type === 'html_ad' && !searchTerm) allGamesContainer.appendChild(createHtmlAdCard(item));
            });
            
            skeletonContainer.style.display = "none";
            actualContent.style.display = "block";
        };
        
        const createGameCard = (game) => {
            const card = document.createElement("a");
            card.href = game.gameUrl || '#';
            card.className = "game-card";

            let title = "Game";
            let category = "General";
            const uiStrings = appLanguages[currentLang]?.ui || {};

            if (game.titles && game.titles[currentLang]) { title = game.titles[currentLang]; } 
            else if (game.titles && game.titles.en) { title = game.titles.en; } 
            else if (game[`title_${currentLang}`]) { title = game[`title_${currentLang}`]; } 
            else { title = game.title_en || "Game"; }

            if (game.categories && game.categories[currentLang]) { category = game.categories[currentLang]; } 
            else if (game.categories && game.categories.en) { category = game.categories.en; } 
            else if (game[`category_${currentLang}`]) { category = game[`category_${currentLang}`]; } 
            else { category = game.category_en || "General"; }
            
            card.innerHTML = `<img src="${game.iconUrl}" alt="${title}" class="game-icon"><div class="game-card-text"><h3>${title}</h3><p>${category}</p></div><div class="btn-play">${uiStrings.play_now_text || 'Play'}</div>`;
            return card;
        };

        const createCategoryCard = (name, count, index, onClick) => {
            const card = document.createElement("div");
            card.className = `category-card c${(index % 2) + 1}`;
            card.onclick = onClick;
            const uiStrings = appLanguages[currentLang]?.ui || {};
            const countText = currentLang === 'or' ? toOdiaNumerals(count) : count.toLocaleString();
            card.innerHTML = `<div class="category-card-content"><h3>${name}</h3><p>${countText} ${uiStrings.games_count_text || 'Games'}</p></div>`;
            return card;
        };
        
        const createHtmlAdCard = (ad) => {
            const card = document.createElement("div");
            card.className = "html-ad-card";
            if(ad.htmlCode) card.innerHTML = ad.htmlCode;
            return card;
        };
        
        const showCategoryModal = (name, games) => {
            categoryModalTitle.textContent = name;
            categoryModalGames.innerHTML = "";
            games.forEach(game => categoryModalGames.appendChild(createGameCard(game)));
            openModal(categoryModal);
        };

        // --- THE FIX IS HERE: This function is now fully dynamic ---
        const buildLangSwitcher = () => {
            langDropdown.innerHTML = '';
            // Loop through ALL languages fetched from Firebase
            for (const langCode in appLanguages) {
                const lang = appLanguages[langCode];
                const li = document.createElement('li');
                li.dataset.lang = langCode;
                li.textContent = lang.displayName;
                langDropdown.appendChild(li);
            }
        };

        function getInitialLanguage() {
            // Build the reverse map dynamically
            urlLangMap = Object.entries(langUrlMap).reduce((acc, [code, param]) => {
                acc[param] = code;
                return acc;
            }, {});

            const params = new URLSearchParams(window.location.search);
            const langFromUrl = params.get('lang');

            // Check pretty URL first, then check if the param is a direct language code
            if (langFromUrl && urlLangMap[langFromUrl] && appLanguages[urlLangMap[langFromUrl]]) {
                return urlLangMap[langFromUrl];
            } else if (langFromUrl && appLanguages[langFromUrl]) {
                return langFromUrl;
            }
            
            const langFromStorage = localStorage.getItem("userLanguage");
            if (langFromStorage && appLanguages[langFromStorage]) {
                return langFromStorage;
            }
            return 'en';
        }

        async function initializeApp() {
            try {
                const [langSnapshot, contentSnapshot] = await Promise.all([
                    db.collection("languages").get(),
                    db.collection("content").orderBy("order", "asc").get()
                ]);

                langSnapshot.forEach(doc => { appLanguages[doc.id] = doc.data(); });
                allContent = contentSnapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));
                
                buildLangSwitcher();
                
                const initialLang = getInitialLanguage();
                setLanguage(initialLang);
                
                loadFooterAd();
                setupVisitorCounter();

            } catch (error) {
                console.error("CRITICAL ERROR during initialization:", error);
                document.body.innerHTML = `<div style="padding: 40px; text-align: center; font-family: sans-serif;"><h1>Error Loading Site</h1><p>Could not fetch required data. This might be due to a missing Firestore index or a network issue.</p><p><strong>For the site admin:</strong> Please check the browser's developer console (F12) for a detailed error message. If it mentions a "missing index", please click the link in the error message to create it in Firebase.</p><pre style="text-align: left; background: #eee; padding: 15px; border-radius: 5px; margin-top: 20px; white-space: pre-wrap; word-wrap: break-word;">${error.message}</pre></div>`;
            }
        }
        
        function setupVisitorCounter() {
            db.collection("counters").doc("pageVisits").onSnapshot(doc => {
                if (doc.exists) {
                    latestVisitCount = doc.data().count;
                    if (appLanguages[currentLang]) {
                        visitCountEl.textContent = currentLang === "or" ? toOdiaNumerals(latestVisitCount) : latestVisitCount.toLocaleString('en-US');
                    }
                }
            });
            db.runTransaction(t => t.get(db.collection("counters").doc("pageVisits")).then(d => t.set(d.ref, { count: (d.exists ? d.data().count : 0) + 1 }))).catch(console.error);
        }
        
        async function loadFooterAd() {
            if (localStorage.getItem('footerAdClosed') === 'true') return;
            try {
                const doc = await db.collection("settings").doc("footerAd").get();
                if (doc.exists) {
                    const data = doc.data();
                    if (data.imageUrl && data.linkUrl) {
                        const banner = document.getElementById('footer-ad-banner');
                        const content = document.getElementById('footer-ad-content');
                        content.innerHTML = `<a href="${data.linkUrl}" target="_blank" rel="noopener sponsored"><img src="${data.imageUrl}" alt="Advertisement"></a>`;
                        banner.style.display = 'flex';
                    }
                }
            } catch (e) { console.error("Error loading footer ad", e); }
        }

        window.addEventListener('popstate', (event) => {
            const initialLang = getInitialLanguage();
            setLanguage(initialLang);
        });

        langSwitcherBtn.addEventListener('click', (e) => { e.stopPropagation(); langDropdown.classList.toggle('active'); });
        langDropdown.addEventListener('click', (e) => {
            if (e.target.tagName === 'LI') {
                const lang = e.target.dataset.lang;
                if (lang) setLanguage(lang);
            }
        });
        document.addEventListener('click', () => langDropdown.classList.remove('active'));
        searchBar.addEventListener("input", renderAll);
        
        function closeMobileMenu() { mobileNav.classList.remove("active"); menuOpen.style.display = "block"; menuClose.style.display = "none"; }
        menuToggle.addEventListener("click", () => { const isActive = mobileNav.classList.toggle("active"); menuOpen.style.display = isActive ? "none" : "block"; menuClose.style.display = isActive ? "block" : "none"; });
        mobileNav.addEventListener("click", e => { if (e.target === mobileNav) closeMobileMenu(); });
        [...document.querySelectorAll(".close-button")].forEach(b => b.addEventListener("click", e => closeModal(e.target.closest(".modal"))));
        document.getElementById('close-footer-ad').addEventListener('click', () => {
            document.getElementById('footer-ad-banner').style.display = 'none';
            localStorage.setItem('footerAdClosed', 'true');
        });
        
        initializeApp();
      });
    </script>
</body>
</html>
